<!DOCTYPE html>
<head>    
    <link rel="stylesheet" href="info.css" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <script>L_PREFER_CANVAS=false; L_NO_TOUCH=false; L_DISABLE_3D=false;</script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.5.1/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.5.1/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"/>
    <link rel="stylesheet" href="https://rawcdn.githack.com/python-visualization/folium/master/folium/templates/leaflet.awesome.rotate.css"/>
    
    <script src="https://cdn.jsdelivr.net/npm/leaflet-search@2.9.7/dist/leaflet-search.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-search@2.9.7/dist/leaflet-search.min.css"/>
    
    <style>html, body {width: 100%;height: 100%;margin: 0;padding: 0;}</style>
    <style>#map {position:relative;top:0;bottom:0;right:0;left:0;}</style>
    
    <meta name="viewport" content="width=device-width,
        initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <style id="MyStyle">#map_b009fcf435914c9d97f8c29c0a3c77b7 {
        position: relative;
        width: 100.0%;
        height: 100.0%;
        left: 0.0%;
        top: 0.0%;
        }
    </style>
</head>
<body>    
    <div class="folium-map" id="map_b009fcf435914c9d97f8c29c0a3c77b7" ></div>
</body>
<script>    
    
    
        var bounds = null;
    

    var map_b009fcf435914c9d97f8c29c0a3c77b7 = L.map(
        'map_b009fcf435914c9d97f8c29c0a3c77b7', {
        center: [48.38955, -4.089069],
        zoom: 10,
        maxBounds: bounds,
        layers: [],
        worldCopyJump: false,
        crs: L.CRS.EPSG3857,
        zoomControl: false,
        });

L.control.zoom({
     position:'topright'
}).addTo(map_b009fcf435914c9d97f8c29c0a3c77b7);
    
    var tile_layer_1ef36e76e894453588b14670b5757073 = L.tileLayer(
        'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
        {
        "attribution": null, 
        "detectRetina": false, 
        "maxNativeZoom": 18, 
        "maxZoom": 18, 
        "minZoom": 0, 
        "noWrap": false, 
        "opacity": 1, 
        "subdomains": "abc", 
        "tms": false
}).addTo(map_b009fcf435914c9d97f8c29c0a3c77b7);

var geo ={
   "type": "FeatureCollection",
   "features": [
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ -4.298937,  48.188593 ]
    },
    "properties": {
    "name":"Pentrez",
    "frequentation":"",
    "city":"",
    "difficulty":"",
    "wind_sector":"",
    "tide_hour":"",
    "picture":"http://cdt35.media.tourinsoft.eu/upload/crtb2-Plage-de-Pentrez.jpg",
    "danger":"",
    "rules":"",
    "parking":"",
    "association_name":"",
    "association_url":"",
    "shop_name":"",
    "shop_url":"",
    "school_name":"",
    "school_url":"",
    "sailmaker_name":"",
    "sailmaker_url":"",
    "accommodations":"",
    "camping":"",
    "report_txt":"",
    "report_pic":"",
    "desc":"",
    "forum":"",
    "comments":"",
    "previsions":"",
    "hours":"",
    "anemometre":"",
    "precipitations":"",
    "webcam":"",
    "temperature":""
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ -4.447596,48.236065 ]
    },
    "properties": {
    "name":"Plage de l'aber",
    "frequentation":"",
    "city":" ",
    "difficulty":"",
    "wind_sector":"",
    "tide_hour":"",
    "picture":"http://cdt35.media.tourinsoft.eu/upload/Plage-de-l-Aber.jpg",
    "danger":" ",
    "rules":" ",
    "parking":" ",
    "association_name":"",
    "association_url":"",
    "shop_name":" ",
    "shop_url":"",
    "school_name":" ",
    "school_url":"",
    "sailmaker_name":"",
    "sailmaker_url":"",
    "accommodations":" ",
    "camping":" ",
    "report_txt":" ",
    "report_pic":" ",
    "desc":" ",
    "forum":"",
    "comments":" ",
    "previsions":" ",
    "hours":" ",
    "anemometre":" ",
    "precipitations":" ",
    "webcam":" ",
    "temperature":" "
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ -4.767251,48.366015 ]
    },
    "properties": {
    "name":"Les blancs sablons",
    "frequentation":"",
    "city":"",
    "difficulty":"",
    "wind_sector":"",
    "tide_hour":"",
    "picture":"http://cdt35.media.tourinsoft.eu/upload/Plage-des-blancs-Sablons-2.jpg",
    "danger":"",
    "rules":"",
    "parking":"",
    "association_name":"",
    "association_url":"",
    "shop_name":"",
    "shop_url":"",
    "school_name":"",
    "school_url":"",
    "sailmaker_name":"",
    "sailmaker_url":"",
    "accommodations":"",
    "camping":"",
    "report_txt":"",
    "report_pic":"",
    "desc":"",
    "forum":"",
    "comments":"",
    "previsions":"",
    "hours":"",
    "anemometre":"",
    "precipitations":"",
    "webcam":"",
    "temperature":""
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ -4.606791, 48.594166 ]
    },
    "properties": {
    "name":"Plage Sainte Marguerite",
    "frequentation":"Elevée",
    "city":"landeda",
    "difficulty":"Tout Niveau",
    "wind_sector":"270;45",
    "tide_hour":"",
    "picture":"http://reveokite.com/wp-content/uploads/2016/02/spot-plage-sites-sainte-marguerite-landeda-reveokite-reve-o-kite-surf-ecole-reparation-kitesurf-brest-finistere-bretagne-29-initiation-0-300x199.jpg",
    "danger":"Aucun",
    "rules":"Zone de baignade en juillet - août",
    "parking":"48.633318; -4.452566",
    "association_name":"FKA ",
    "association_url":"http://www.fka.fr/",
    "shop_name":"Side Shore",
    "shop_url":"https://www.side-shore.com/8/water-sports",
    "school_name":"Kite Coaching",
    "school_url":"https://www.kitesurf-coaching.com/",
    "sailmaker_name":"J’ai cassé ma voile !",
    "sailmaker_url":"http://www.jaicassemavoile.com/",
    "accommodations":"",
    "camping":"",
    "report_txt":"",
    "report_pic":"",
    "desc":"",
    "forum":"",
    "comments":"",
    "previsions":"https://www.windguru.cz/48441",
    "hours":"http://maree.info/74",
    "anemometre":"https://data.diabox.com/?id=17",
    "precipitations":"https://data.diabox.com/?id=17",
    "webcam":"https://data.diabox.com/?id=17",
    "temperature":"vent.PNG"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ -4.443228,48.639587 ]
    },
    "properties": {
    "name":"Le Vougot",
    "frequentation":"Faible",
    "city":"Guisseny",
    "difficulty":"Intermédiaire",
    "wind_sector":"225;0",
    "tide_hour":"",
    "picture":"https://www.plages.tv/gallery/cms/images/plage-vougo-guisseny-7.jpg",
    "danger":"Quelques récifs découvrants en fonction de la marée",
    "rules":"Aucune",
    "parking":"48.594859; -4.605982",
    "association_name":"GPA",
    "association_url":"http://www.glissepaganassociation.fr/",
    "shop_name":"Ataoride",
    "shop_url":"https://www.ataoride.com/",
    "school_name":"ReveOkite",
    "school_url":"http://reveokite.com/",
    "sailmaker_name":"J’ai cassé ma voile !",
    "sailmaker_url":"http://www.jaicassemavoile.com/",
    "accommodations":"",
    "camping":"",
    "report_txt":"",
    "report_pic":"",
    "desc":"",
    "forum":"",
    "comments":"",
    "previsions":"https://www.windguru.cz/48438",
    "hours":"http://maree.info/74",
    "anemometre":"https://data.diabox.com/?id=104",
    "precipitations":"https://data.diabox.com/?id=104",
    "webcam":"https://data.diabox.com/?id=104",
    "temperature":"vent.PNG"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [   -4.657216,48.571141 ]
    },
    "properties": {
    "name":"Tréompan, les trois moutons",
    "frequentation":"",
    "city":"",
    "difficulty":"",
    "wind_sector":"",
    "tide_hour":"",
    "picture":"https://www.plages.tv/gallery/cms/images/plage-treompan-ploudalmezeau-1.jpg",
    "danger":"",
    "rules":"",
    "parking":"",
    "association_name":"",
    "association_url":"",
    "shop_name":"",
    "shop_url":"",
    "school_name":"",
    "school_url":"",
    "sailmaker_name":"",
    "sailmaker_url":"",
    "accommodations":"",
    "camping":"",
    "report_txt":"",
    "report_pic":"",
    "desc":"",
    "forum":"",
    "comments":"",
    "previsions":"",
    "hours":"",
    "anemometre":"",
    "precipitations":"",
    "webcam":"",
    "temperature":""
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ -4.237804,48.650788 ]
    },
    "properties": {
    "name":"Keremma",
    "frequentation":"",
    "city":"",
    "difficulty":"",
    "wind_sector":"",
    "tide_hour":"",
    "picture":"https://www.plages.tv/gallery/cms/images/plage-keremma-plounevez-lochrist.jpg",
    "danger":"",
    "rules":"",
    "parking":"",
    "association_name":"",
    "association_url":"",
    "shop_name":"",
    "shop_url":"",
    "school_name":"",
    "school_url":"",
    "sailmaker_name":"",
    "sailmaker_url":"",
    "accommodations":"",
    "camping":"",
    "report_txt":"",
    "report_pic":"",
    "desc":"",
    "forum":"",
    "comments":"",
    "previsions":"",
    "hours":"",
    "anemometre":"",
    "precipitations":"",
    "webcam":"",
    "temperature":""
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ -4.138756,48.692717 ]
    },
    "properties": {
    "name":"Les amiets",
    "frequentation":"",
    "city":"",
    "difficulty":"",
    "wind_sector":"",
    "tide_hour":"",
    "picture":"https://www.plages.tv/gallery/cms/images/plage-amiets-cleder-4.jpg",
    "danger":"",
    "rules":"",
    "parking":"",
    "association_name":"",
    "association_url":"",
    "shop_name":"",
    "shop_url":"",
    "school_name":"",
    "school_url":"",
    "sailmaker_name":"",
    "sailmaker_url":"",
    "accommodations":"",
    "camping":"",
    "report_txt":"",
    "report_pic":"",
    "desc":"",
    "forum":"",
    "comments":"",
    "previsions":"",
    "hours":"",
    "anemometre":"",
    "precipitations":"",
    "webcam":"",
    "temperature":""
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ -3.809287,48.711889 ]
    },
    "properties": {
    "name":"Priel Tregastel",
    "frequentation":"",
    "city":"",
    "difficulty":"",
    "wind_sector":"",
    "tide_hour":"",
    "picture":"https://www.sensation-bretagne.com/wp-content/uploads/2016/09/Plougasnou2013_MG_4276b_800x450_acf_cropped.jpg",
    "danger":"",
    "rules":"",
    "parking":"",
    "association_name":"",
    "association_url":"",
    "shop_name":"",
    "shop_url":"",
    "school_name":"",
    "school_url":"",
    "sailmaker_name":"",
    "sailmaker_url":"",
    "accommodations":"",
    "camping":"",
    "report_txt":"",
    "report_pic":"",
    "desc":"",
    "forum":"",
    "comments":"",
    "previsions":"",
    "hours":"",
    "anemometre":"",
    "precipitations":"",
    "webcam":"",
    "temperature":""
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ -3.780023,48.701735 ]
    },
    "properties": {
    "name":"Saint Jean du doigt",
    "frequentation":"",
    "city":"",
    "difficulty":"",
    "wind_sector":"",
    "tide_hour":"",
    "picture":"https://www.sensation-bretagne.com/wp-content/uploads/tourinsoft/plage-sjdd.jpg",
    "danger":"",
    "rules":"",
    "parking":"",
    "association_name":"",
    "association_url":"",
    "shop_name":"",
    "shop_url":"",
    "school_name":"",
    "school_url":"",
    "sailmaker_name":"",
    "sailmaker_url":"",
    "accommodations":"",
    "camping":"",
    "report_txt":"",
    "report_pic":"",
    "desc":"",
    "forum":"",
    "comments":"",
    "previsions":"",
    "hours":"",
    "anemometre":"",
    "precipitations":"",
    "webcam":"",
    "temperature":""
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ -3.568454,48.680279 ]
    },
    "properties": {
    "name":"Saint Michel en Greve",
    "frequentation":"",
    "city":"",
    "difficulty":"",
    "wind_sector":"",
    "tide_hour":"",
    "picture":"https://www.plages.tv/gallery/cms/images/plage-st-michel-greve-22-4.jpg",
    "danger":"",
    "rules":"",
    "parking":"",
    "association_name":"",
    "association_url":"",
    "shop_name":"",
    "shop_url":"",
    "school_name":"",
    "school_url":"",
    "sailmaker_name":"",
    "sailmaker_url":"",
    "accommodations":"",
    "camping":"",
    "report_txt":"",
    "report_pic":"",
    "desc":"",
    "forum":"",
    "comments":"",
    "previsions":"",
    "hours":"",
    "anemometre":"",
    "precipitations":"",
    "webcam":"",
    "temperature":""
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ -4.521801,48.629512 ]
    },
    "properties": {
    "name":"",
    "frequentation":"",
    "city":"",
    "difficulty":"",
    "wind_sector":"",
    "tide_hour":"",
    "picture":"",
    "danger":"",
    "rules":"",
    "parking":"",
    "association_name":"",
    "association_url":"",
    "shop_name":"",
    "shop_url":"",
    "school_name":"",
    "school_url":"",
    "sailmaker_name":"",
    "sailmaker_url":"",
    "accommodations":"",
    "camping":"",
    "report_txt":"",
    "report_pic":"",
    "desc":"",
    "forum":"",
    "comments":"",
    "previsions":"",
    "hours":"",
    "anemometre":"",
    "precipitations":"",
    "webcam":"",
    "temperature":""
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ -4.566347,48.624719 ]
    },
    "properties": {
    "name":"Lilia",
    "frequentation":"",
    "city":"",
    "difficulty":"",
    "wind_sector":"",
    "tide_hour":"",
    "picture":"https://www.plages.tv/gallery/cms/images/plage-st-cava-plouguerneau-2.jpg",
    "danger":"",
    "rules":"",
    "parking":"",
    "association_name":"",
    "association_url":"",
    "shop_name":"",
    "shop_url":"",
    "school_name":"",
    "school_url":"",
    "sailmaker_name":"",
    "sailmaker_url":"",
    "accommodations":"",
    "camping":"",
    "report_txt":"",
    "report_pic":"",
    "desc":"",
    "forum":"",
    "comments":"",
    "previsions":"",
    "hours":"",
    "anemometre":"",
    "precipitations":"",
    "webcam":"",
    "temperature":""
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ -4.566047,48.616662 ]
    },
    "properties": {
    "name":"Saint cava",
    "frequentation":"",
    "city":"",
    "difficulty":"",
    "wind_sector":"",
    "tide_hour":"",
    "picture":"https://www.plages.tv/gallery/cms/images/plage-st-cava-plouguerneau-3.jpg",
    "danger":"",
    "rules":"",
    "parking":"",
    "association_name":"",
    "association_url":"",
    "shop_name":"",
    "shop_url":"",
    "school_name":"",
    "school_url":"",
    "sailmaker_name":"",
    "sailmaker_url":"",
    "accommodations":"",
    "camping":"",
    "report_txt":"",
    "report_pic":"",
    "desc":"",
    "forum":"",
    "comments":"",
    "previsions":"",
    "hours":"",
    "anemometre":"",
    "precipitations":"",
    "webcam":"",
    "temperature":""
    }
  }
]
}   ;

var vents = { "type": "FeatureCollection",
    "features": [
      { "type": "Feature",
        "geometry": {
          "type": "Point",
          "coordinates": [-4.606791,48.594166]
          },
          "properties": {
            "vitesse_etabli": "15",
            "rafales": "20",
            "unite": "noeuds",
            "direction": "260",
            "vagues": "1.5"
            
          }
        },
        { "type": "Feature",
        "geometry": {
          "type": "Point",
          "coordinates": [-4.443228,    48.639587]
          },
          "properties": {
            "vitesse_etabli": "17",
            "rafales": "28",
            "unite": "noeuds",
            "direction": "220",
            "vagues": "1.1"
        
          }
         }
    ]
};


function showMenu () {
    //Modificatiaon du style de la carte
    var divNode = document.createElement("div");
    divNode.innerHTML = "<br><style>#map_b009fcf435914c9d97f8c29c0a3c77b7 { z-index: -100; }</style>";
    document.body.appendChild(divNode);
    // crée un nouvel élément div qui va contenier les informations de niveau 2
    var newDiv = document.createElement("div");
    newDiv.setAttribute('id','Menu')
    newDiv.setAttribute('rel', "stylsheet");
    newDiv.setAttribute("style", "background-color: rgb(33, 133, 171); position:absolute; top: 0px;  left: 0px; width: 30%; height: 100%; z-index: 100");
    // ajoute le nouvel élément créé et son contenu dans le DOM
    var currentDiv = document.getElementById('Menu');
    document.body.insertBefore(newDiv, currentDiv);

    }

function showInformations(informations) {
    console.log(informations.length)
    var newDiv = document.createElement("div");
    var textnode = document.createTextNode(informations[0]);
    newDiv.setAttribute("class", "Info")
    newDiv.appendChild(textnode);
    document.getElementById('Menu').appendChild(newDiv)
    //
    var newDiv = document.createElement("div");
    var textnode = document.createTextNode(informations[1]);
    newDiv.appendChild(textnode);
    document.getElementById('Menu').appendChild(newDiv)
    //
    var newDiv = document.createElement("img");
    newDiv.setAttribute('src',informations[2])
    newDiv.setAttribute('height', '300px')
    newDiv.setAttribute('width','384px')
    document.getElementById('Menu').appendChild(newDiv)
    //
    var newDiv = document.createElement("div");
    var textnode = document.createTextNode("Dangers : "+informations[3]);
    newDiv.appendChild(textnode);
    newDiv.setAttribute("style", "font-size : 20px");
    document.getElementById('Menu').appendChild(newDiv)
    //
    var newDiv = document.createElement("img");
    newDiv.setAttribute('src',informations[4])
    newDiv.setAttribute('height', 'auto')
    newDiv.setAttribute('width','384px')
    document.getElementById('Menu').appendChild(newDiv)
    //
    var newDiv = document.createElement("div");
    var textnode = document.createTextNode("Avis : Spot super sympa, bon vent! ");
    newDiv.setAttribute("style", "font-size : 20px")
    newDiv.appendChild(textnode);
    document.getElementById('Menu').appendChild(newDiv)
    }



function events(feature,layer)
{
    layer.on({ mouseover :  function(e) {
        layer.bindPopup(layer.feature.properties.name).openPopup();
        if(vents.features[0].geometry.coordinates[0]==layer.feature.geometry.coordinates[0] && vents.features[0].geometry.coordinates[1]==layer.feature.geometry.coordinates[1])
        {
            var words = layer.feature.properties.wind_sector.split(';');
            if(vents.features[0].properties.vitesse_etabli>=15 && words[1]<vents.features[0].properties.direction && vents.features[0].properties.direction<words[0])
            {   
                console.log("set green")
                layer._icon.src='images/marker-icon-green.png';
            }
            else
            {
                layer._icon.src='images/marker-icon-red.png';
            }            
        }
        else if(vents.features[1].geometry.coordinates[0]==layer.feature.geometry.coordinates[0] && vents.features[1].geometry.coordinates[1]==layer.feature.geometry.coordinates[1])
        {
            var words = layer.feature.properties.wind_sector.split(';');
            if(vents.features[1].properties.vitesse_etabli>=15 && words[1]<=vents.features[1].properties.direction && vents.features[1].properties.direction<=words[0])
            {
                layer._icon.src='images/marker-icon-green.png';
            }
            else
            {
                layer._icon.src='images/marker-icon-red.png';
            }
        }
        photoImg = '<img src='+layer.feature.properties.picture+' height="150px" width="150px"/>';
        
        layer.bindPopup("<center>"+layer.feature.properties.name+"</center>" + "</br>"+ photoImg).openPopup();
                                    }
    });

    layer.on({click :  function(e) {
        console.log("click");
        var informations = [];
        informations.push(layer.feature.properties.name)
        informations.push(layer.feature.properties.city)
        informations.push(layer.feature.properties.picture)
        informations.push(layer.feature.properties.danger)
        informations.push(layer.feature.properties.temperature)
        showMenu()
        //on y ajoute les informations
        console.log(layer.feature.properties.name)
        showInformations(informations)
    }});
}

var new_layer = L.geoJSON(geo,{onEachFeature : events}).addTo(map_b009fcf435914c9d97f8c29c0a3c77b7);
//add search bar
var searchControl = new L.Control.Search({
               layer: new_layer,
               propertyName: 'name',
               collapsed: true,
               textPlaceholder: 'Search',
               marker: false,
               position:'topright',
               moveToLocation: function(latlng, title, map) {
               var zoom =  12
                   map.flyTo(latlng, zoom); // access the zoom
               }
               });

searchControl.on('search:locationfound', function(e) {
                   new_layer.setStyle(function(feature){
                       return feature.properties.style
                   })
                   if(e.layer._popup)
                       e.layer.openPopup();
               });

searchControl.on('search:collapsed', function(e) {
                       new_layer.setStyle(function(feature){
                           return feature.properties.style
                   });
               });

map_b009fcf435914c9d97f8c29c0a3c77b7.addControl(searchControl);

</script>
